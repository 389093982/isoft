webpackJsonp([2],{Gu7T:function(e,r,t){"use strict";r.__esModule=!0;var s,a=t("c/Tr"),n=(s=a)&&s.__esModule?s:{default:s};r.default=function(e){if(Array.isArray(e)){for(var r=0,t=Array(e.length);r<e.length;r++)t[r]=e[r];return t}return(0,n.default)(e)}},cGM2:function(e,r){},dh6x:function(e,r){},e7nt:function(e,r){},fCil:function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s=t("Xxa5"),a=t.n(s),n=t("exGp"),o=t.n(n),u=t("GCuT"),i=t("gyMJ"),c=t("Nb9Q"),l=t("XZCL"),d=t("I1g2"),m={name:"ResourceEdit",components:{WorkStepComponent:t("leY6").a,ISimpleBtnTriggerModal:d.a},data:function(){return{globalVars:[],formValidate:{resource_id:0,resource_name:"",resource_type:"",resource_url:"",resource_dsn:"",resource_username:"",resource_password:"",env_name:""},ruleValidate:{resource_name:[{required:!0,message:"resource_name 不能为空!",trigger:"blur"}],resource_type:[{required:!0,message:"resource_type 不能为空!",trigger:"change"}],resource_url:[{required:!0,message:"resource_url 不能为空!",trigger:"blur"}],resource_dsn:[{required:!0,message:"resource_dsn 不能为空!",trigger:"blur"}],resource_username:[{required:!0,message:"resource_username 不能为空!",trigger:"blur"}],resource_password:[{required:!0,message:"resource_password 不能为空!",trigger:"blur"}]}}},methods:{dragstart:function(e,r){e.dataTransfer.setData("Text",r)},allowDrop:function(e){e.preventDefault()},drop:function(e,r){e.stopPropagation(),e.preventDefault();var t=e.dataTransfer.getData("Text");this.$set(this.formInline,r,t)},initData:function(){var e=o()(a.a.mark(function e(r){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.$refs.triggerModal.triggerClick(),e.next=3,Object(i.M)(r);case 3:"SUCCESS"==(t=e.sent).status&&(this.formValidate.resource_id=t.resource.id,this.formValidate.resource_name=t.resource.resource_name,this.formValidate.resource_type=t.resource.resource_type,this.formValidate.resource_url=t.resource.resource_url,this.formValidate.resource_dsn=t.resource.resource_dsn,this.formValidate.resource_username=t.resource.resource_username,this.formValidate.resource_password=t.resource.resource_password,this.formValidate.env_name=t.resource.env_name);case 5:case"end":return e.stop()}},e,this)}));return function(r){return e.apply(this,arguments)}}(),handleSubmit:function(e){var r,t=this;this.$refs[e].validate((r=o()(a.a.mark(function e(r){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=5;break}return e.next=3,Object(i.s)(t.formValidate.resource_id,t.formValidate.resource_name,t.formValidate.resource_type,t.formValidate.resource_url,t.formValidate.resource_dsn,t.formValidate.resource_username,t.formValidate.resource_password);case 3:"SUCCESS"==e.sent.status?(t.$Message.success("提交成功!"),t.$refs.triggerModal.hideModal(),t.handleReset("formValidate"),t.$emit("handleSuccess")):t.$Message.error("提交失败!");case 5:case"end":return e.stop()}},e,t)})),function(e){return r.apply(this,arguments)}))},handleReset:function(e){this.$refs[e].resetFields()},refreshAllGlobalVars:function(){var e=o()(a.a.mark(function e(){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(i.D)();case 2:"SUCCESS"==(r=e.sent).status&&(this.globalVars=r.globalVars);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},mounted:function(){this.refreshAllGlobalVars()}},f={render:function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("ISimpleBtnTriggerModal",{ref:"triggerModal",attrs:{"btn-text":"新增资源信息","btn-size":"small","modal-title":"新增/编辑资源信息","modal-top":"50px","modal-width":800}},[t("Row",[t("Col",{attrs:{span:"6"}},[t("Scroll",e._l(e.globalVars,function(r,s){return t("Tag",[t("span",{attrs:{draggable:"true"},on:{dragstart:function(t){e.dragstart(t,r)}}},[e._v(e._s(r))])])}))],1),e._v(" "),t("Col",{attrs:{span:"18"}},[t("Form",{ref:"formValidate",attrs:{model:e.formValidate,rules:e.ruleValidate,"label-width":140}},[t("FormItem",{attrs:{label:"resource_name",prop:"resource_name"}},[t("Input",{attrs:{placeholder:"请输入 resource_name"},model:{value:e.formValidate.resource_name,callback:function(r){e.$set(e.formValidate,"resource_name","string"==typeof r?r.trim():r)},expression:"formValidate.resource_name"}})],1),e._v(" "),t("FormItem",{attrs:{label:"resource_type",prop:"resource_type"}},[t("Select",{attrs:{placeholder:"请选择 resource_type"},model:{value:e.formValidate.resource_type,callback:function(r){e.$set(e.formValidate,"resource_type",r)},expression:"formValidate.resource_type"}},[t("Option",{attrs:{value:"db"}},[e._v("db")]),e._v(" "),t("Option",{attrs:{value:"sftp"}},[e._v("sftp")]),e._v(" "),t("Option",{attrs:{value:"ssh"}},[e._v("ssh")])],1)],1),e._v(" "),t("FormItem",{attrs:{label:"resource_url",prop:"resource_url"}},[t("Input",{attrs:{placeholder:"请输入 resource_url"},model:{value:e.formValidate.resource_url,callback:function(r){e.$set(e.formValidate,"resource_url","string"==typeof r?r.trim():r)},expression:"formValidate.resource_url"}})],1),e._v(" "),t("FormItem",{attrs:{label:"resource_dsn",prop:"resource_dsn"}},[t("Input",{attrs:{placeholder:"请输入 resource_dsn"},on:{drop:function(r){e.drop(r,"resource_dsn")},dragover:function(r){e.allowDrop(r)}},model:{value:e.formValidate.resource_dsn,callback:function(r){e.$set(e.formValidate,"resource_dsn","string"==typeof r?r.trim():r)},expression:"formValidate.resource_dsn"}})],1),e._v(" "),t("FormItem",{attrs:{label:"resource_username",prop:"resource_username"}},[t("Input",{attrs:{placeholder:"请输入 resource_username"},model:{value:e.formValidate.resource_username,callback:function(r){e.$set(e.formValidate,"resource_username","string"==typeof r?r.trim():r)},expression:"formValidate.resource_username"}})],1),e._v(" "),t("FormItem",{attrs:{label:"resource_password",prop:"resource_password"}},[t("Input",{attrs:{placeholder:"请输入 resource_password"},model:{value:e.formValidate.resource_password,callback:function(r){e.$set(e.formValidate,"resource_password","string"==typeof r?r.trim():r)},expression:"formValidate.resource_password"}})],1),e._v(" "),t("FormItem",[t("Button",{staticStyle:{"margin-right":"6px"},attrs:{type:"success"},on:{click:function(r){e.handleSubmit("formValidate")}}},[e._v("提交")]),e._v(" "),t("Button",{staticStyle:{"margin-right":"6px"},attrs:{type:"warning"},on:{click:function(r){e.handleReset("formValidate")}}},[e._v("重置")])],1)],1)],1)],1)],1)},staticRenderFns:[]};var p=t("VU/8")(m,f,!1,function(e){t("dh6x")},"data-v-bb131320",null).exports,_={name:"ResourceList",components:{ISimpleLeftRightRow:c.default,ISimpleSearch:l.default,ResourceEdit:p},data:function(){var e=this;return{current_page:1,total:0,offset:10,search:"",resources:[],columns1:[{title:"resource_name",key:"resource_name",width:150},{title:"resource_type",key:"resource_type",width:120},{title:"resource_url",key:"resource_url",width:150},{title:"resource_dsn",key:"resource_dsn",width:320},{title:"resource_username",key:"resource_username",width:160},{title:"resource_password",key:"resource_password",width:200},{title:"last_updated_time",key:"last_updated_time",width:150,render:function(e,r){return e("div",Object(u.e)(new Date(r.row.last_updated_time),"yyyy-MM-dd hh:mm"))}},{title:"操作",key:"operate",width:280,fixed:"right",render:function(r,t){return r("div",[r("Button",{props:{type:"error",size:"small"},style:{marginRight:"5px"},on:{click:function(){e.validateResource(e.resources[t.index].id)}}},"连接测试"),r("Button",{props:{type:"success",size:"small"},style:{marginRight:"5px"},on:{click:function(){e.$refs.resource_edit.initData(e.resources[t.index].id)}}},"编辑"),r("Button",{props:{type:"warning",size:"small"},style:{marginRight:"5px"},on:{click:function(){e.deleteResource(e.resources[t.index].id)}}},"删除")])}}]}},methods:{validateResource:function(){var e=o()(a.a.mark(function e(r){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(i._11)(r);case 2:"SUCCESS"==(t=e.sent).status?this.$Message.success("验证通过!"):this.$Message.error("验证失败!"+t.errorMsg);case 4:case"end":return e.stop()}},e,this)}));return function(r){return e.apply(this,arguments)}}(),deleteResource:function(){var e=o()(a.a.mark(function e(r){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(i.j)(r);case 2:"SUCCESS"==e.sent.status&&this.refreshResourceList();case 4:case"end":return e.stop()}},e,this)}));return function(r){return e.apply(this,arguments)}}(),refreshResourceList:function(){var e=o()(a.a.mark(function e(){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(i._5)(this.offset,this.current_page,this.search);case 2:"SUCCESS"==(r=e.sent).status&&(this.resources=r.resources,this.total=r.paginator.totalcount);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),handleChange:function(e){this.current_page=e,this.refreshResourceList()},handlePageSizeChange:function(e){this.offset=e,this.refreshResourceList()},handleSearch:function(e){this.offset=10,this.current_page=1,this.search=e,this.refreshResourceList()}},mounted:function(){this.refreshResourceList()}},h={render:function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("div",{staticStyle:{margin:"10px"}},[t("ISimpleLeftRightRow",{staticStyle:{"margin-bottom":"10px","margin-right":"10px"}},[t("ResourceEdit",{ref:"resource_edit",attrs:{slot:"left"},on:{handleSuccess:e.refreshResourceList},slot:"left"}),e._v(" "),t("ISimpleSearch",{attrs:{slot:"right"},on:{handleSimpleSearch:e.handleSearch},slot:"right"})],1),e._v(" "),t("Table",{attrs:{border:"",columns:e.columns1,data:e.resources,size:"small"}}),e._v(" "),t("Page",{attrs:{total:e.total,"page-size":e.offset,"show-total":"","show-sizer":"",styles:{"text-align":"center","margin-top":"10px"}},on:{"on-change":e.handleChange,"on-page-size-change":e.handlePageSizeChange}})],1)},staticRenderFns:[]};var g=t("VU/8")(_,h,!1,function(e){t("cGM2")},"data-v-ce609b4e",null);r.default=g.exports},leY6:function(e,r,t){"use strict";var s=t("Gu7T"),a=t.n(s),n=t("lHA8"),o=t.n(n),u=t("Xxa5"),i=t.n(u),c=t("exGp"),l=t.n(c),d=t("gyMJ"),m=t("GCuT"),f={name:"WorkStepComponent",data:function(){return{showComponentDrawer:!1,nodeMetas:[],works:[],module_names:[]}},methods:{showComponent:function(e){return!Object(m.i)(e,["work_start","work_end"])},dragstart:function(e,r){e.dataTransfer.setData("Text",r)},toggleShow:function(){this.showComponentDrawer=!this.showComponentDrawer},refreshAllWorks:function(){var e=l()(i.a.mark(function e(){var r,t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(d.C)();case 2:"SUCCESS"==(r=e.sent).status&&(this.works=r.works,t=this.works.map(function(e){return e.module_name}),this.module_names=this.getUniqueArr(t));case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),getUniqueArr:function(e){var r=new o.a(e);return[].concat(a()(r))},refreshNodeMetas:function(){var e=l()(i.a.mark(function e(){var r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(d.K)("nodeMetas");case 2:"SUCCESS"==(r=e.sent).status&&(this.nodeMetas=r.nodeMetas);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},mounted:function(){this.refreshAllWorks(),this.refreshNodeMetas()}},p={render:function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("Drawer",{attrs:{title:"全部组件",placement:"left",closable:!0,mask:!1,scrollable:""},model:{value:e.showComponentDrawer,callback:function(r){e.showComponentDrawer=r},expression:"showComponentDrawer"}},[t("Tabs",{attrs:{value:"name1"}},[t("TabPane",{attrs:{label:"组件",name:"name1"}},e._l(e.nodeMetas,function(r){return t("span",{attrs:{draggable:"true"},on:{dragstart:function(t){e.dragstart(t,"work_type__"+r.name)}}},[e.showComponent(r.name)?t("Tag",[e._v(e._s(r.name))]):e._e()],1)})),e._v(" "),t("TabPane",{attrs:{label:"流程",name:"name2"}},[t("Collapse",[e._l(e.module_names,function(r){return t("Panel",{attrs:{name:r}},[e._v("\n          "+e._s(r)+"\n          "),t("div",{attrs:{slot:"content"},slot:"content"},e._l(e.works,function(s){return s.module_name==r?t("div",{attrs:{draggable:"true"},on:{dragstart:function(r){e.dragstart(r,"work_name__"+s.work_name)}}},[t("Tag",[t("span",{on:{click:function(r){e.$router.push({path:"/iwork/workList",query:{work_name:s.work_name}})}}},[e._v(e._s(s.work_name))])])],1):e._e()}))])}),e._v(" "),t("Panel",{attrs:{name:"all"}},[e._v("\n          全部\n          "),t("div",{attrs:{slot:"content"},slot:"content"},e._l(e.works,function(r){return t("div",{attrs:{draggable:"true"},on:{dragstart:function(t){e.dragstart(t,"work_name__"+r.work_name)}}},[t("Tag",[t("span",{on:{click:function(t){e.$router.push({path:"/iwork/workList",query:{work_name:r.work_name}})}}},[e._v(e._s(r.work_name))])])],1)}))])],2)],1)],1)],1)},staticRenderFns:[]};var _=t("VU/8")(f,p,!1,function(e){t("e7nt")},"data-v-04fa9318",null);r.a=_.exports}});
//# sourceMappingURL=2.895e87d5dfe5f883b1fb.js.map