webpackJsonp([15],{"8mAf":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r("fZjL"),o=r.n(n),s=r("Xxa5"),a=r.n(s),i=r("exGp"),l=r.n(i),c=r("gyMJ"),u=r("GCuT"),d={name:"WorkList",components:{ISimpleLeftRightRow:function(){return r.e(26).then(r.bind(null,"Nb9Q"))},ISimpleSearch:function(){return r.e(25).then(r.bind(null,"XZCL"))},WorkValidate:function(){return r.e(23).then(r.bind(null,"9Bh1"))},ISimpleConfirmModal:function(){return r.e(27).then(r.bind(null,"pwhd"))},IKeyValueForm:function(){return r.e(24).then(r.bind(null,"gPTX"))}},data:function(){var e=this;return{nodeMetas:[],search_work_type:"all",search_module:"all",current_page:1,total:0,offset:10,search:"",works:[],runLogRecordCount:{},current_work_type:"work",current_module_name:"",current_cache_result:"false",choose_module_name:"",modules:[],visible:!1,columns1:[{title:"work_name",key:"work_name",width:250,render:function(t,r){return t("div",[t("span",{style:{marginRight:"10px",color:"red"}},e.works[r.index].work_type),t("span",e.works[r.index].work_name)])}},{title:"module_name",key:"module_name",width:120},{title:"error/total",key:"error/total",width:130,render:function(t,r){return t("div",[t("span",{style:{color:"red"}},e.getErrorOrTotalCount(e.works[r.index].id,"error")),t("span",e.getErrorOrTotalCount(e.works[r.index].id,"total"))])}},{title:"work_desc",key:"work_desc",width:400},{title:"操作",key:"operate",width:450,fixed:"right",render:function(t,r){return t("div",[t("Button",{props:{type:"success",size:"small"},style:{marginRight:"5px"},on:{click:function(){e.$refs.workEditModal.showModal(),e.$refs.workEditForm.initFormData(e.works[r.index].id,e.works[r.index].work_name,e.works[r.index].work_desc,e.works[r.index].cache_result),e.current_work_type=e.works[r.index].work_type,e.current_module_name=e.works[r.index].module_name,e.current_cache_result=1==e.works[r.index].cache_result?"true":"false"}}},"编辑"),t("Button",{props:{type:"info",size:"small"},style:{marginRight:"5px"},on:{click:function(){e.deleteOrCopyWorkById("copy",e.works[r.index].id)}}},"复制"),t("Button",{props:{type:"error",size:"small"},style:{marginRight:"5px"},on:{click:function(){var t=e;t.$Modal.confirm({title:"删除",content:"确认删除该条数据吗？请谨慎操作！",onOk:function(){t.deleteOrCopyWorkById("delete",t.works[r.index].id)},onCancel:function(){t.$Message.info("取消操作")}})}}},"删除"),t("Button",{props:{type:"info",size:"small"},style:{marginRight:"5px"},on:{click:function(){e.download(e.works[r.index].id)}}},"下载"),t("Button",{props:{type:"error",size:"small"},style:{marginRight:"5px"},on:{click:function(){e.editWorkSteps(e.works[r.index].id,e.works[r.index].work_name)}}},"编辑步骤"),t("Button",{props:{type:"success",size:"small"},style:{marginRight:"5px"},on:{click:function(){e.runWork(e.works[r.index].id)}}},"运行流程"),t("Button",{props:{type:"error",size:"small"},style:{marginRight:"5px"},on:{click:function(){e.$router.push({path:"/iwork/runLogList",query:{work_id:e.works[r.index].id}})}}},"运行日志")])}}]}},methods:{chooseWorkStepType:function(e){this.$refs.search.initSearchText(e),this.search=e,this.refreshWorkList()},closePoptip:function(e){this.current_module_name=e,this.visible=!1},filterWorkTypes:function(e){this.search_work_type=e,this.refreshWorkList()},filterModuleWork:function(e){this.search_module=e,this.refreshWorkList()},refreshWorkList:function(){var e=l()(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(c.J)(this.offset,this.current_page,this.search,this.search_work_type,this.search_module);case 2:"SUCCESS"==(t=e.sent).status&&(this.works=t.works,this.total=t.paginator.totalcount,this.runLogRecordCount=t.runLogRecordCount);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),handleChange:function(e){this.current_page=e,this.refreshWorkList()},handlePageSizeChange:function(e){this.offset=e,this.refreshWorkList()},handleSearch:function(e){this.offset=10,this.current_page=1,this.search=e,this.refreshWorkList()},download:function(e){window.location.href="/api/iwork/download/"+e},deleteOrCopyWorkById:function(){var e=l()(a.a.mark(function e(t,r){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(c.l)(t,r);case 2:"SUCCESS"==e.sent.status&&this.refreshWorkList();case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),addWork:function(){this.$refs.workEditModal.showModal()},editWork:function(){var e=l()(a.a.mark(function e(t,r,n){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(u.a)(this.current_module_name)){e.next=3;break}return this.$Message.error("请选择模块！"),e.abrupt("return");case 3:return e.next=5,Object(c.A)(t,r,n,this.current_work_type,this.current_module_name,this.current_cache_result);case 5:"SUCCESS"==e.sent.status?(this.$refs.workEditModal.hideModal(),this.$refs.workEditForm.handleSubmitSuccess("提交成功!"),this.refreshWorkList()):this.$refs.workEditForm.handleSubmitError("提交失败!");case 7:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}(),runWork:function(){var e=l()(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(c._14)(t);case 2:"SUCCESS"==e.sent.status&&this.$Message.success("运行任务已触发!");case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),editWorkSteps:function(e,t){this.$router.push({path:"/iwork/workstepList",query:{work_id:e,work_name:t}})},workNameValidator:function(e,t,r){""===t?r(new Error("字段值不能为空!")):Object(u.k)(t)?r():r(new Error("存在非法字符，只能包含字母，数字，下划线!"))},getErrorOrTotalCount:function(e,t){var r=o()(this.runLogRecordCount).filter(function(t){return t==e})[0];return"error"==t?this.runLogRecordCount[r].errorCount:"/"+this.runLogRecordCount[r].allCount},refreshAllModules:function(){var e=l()(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(c.N)();case 2:"SUCCESS"==(t=e.sent).status&&(this.modules=t.moudles);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),refreshNodeMetas:function(){var e=l()(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(c.S)("nodeMetas");case 2:"SUCCESS"==(t=e.sent).status&&(this.nodeMetas=t.nodeMetas);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},mounted:function(){null!=this.$route.query.work_name&&(this.search=this.$route.query.work_name),this.refreshWorkList(),this.refreshAllModules(),this.refreshNodeMetas()}},h={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticStyle:{margin:"10px"}},[r("Row",{attrs:{type:"flex",justify:"center"}},[r("Col",{attrs:{span:"3"}},[r("WorkValidate")],1)],1),e._v(" "),r("ISimpleLeftRightRow",{staticStyle:{margin:"10px 10px"}},[r("span",{attrs:{slot:"left"},slot:"left"},[r("Button",{attrs:{type:"success",size:"small"},on:{click:e.addWork}},[e._v("新增")]),e._v(" "),r("Button",{attrs:{type:"warning",size:"small"},on:{click:function(t){e.$router.push({path:"/iwork/filterList"})}}},[e._v("过滤器配置")]),e._v(" "),r("ISimpleConfirmModal",{ref:"workEditModal",attrs:{"modal-title":"新增/编辑 Work","modal-width":600,"footer-hide":!0,"modal-top":"50px"}},[r("IKeyValueForm",{ref:"workEditForm",attrs:{"form-key-label":"work_name","form-value-label":"work_desc","form-key-placeholder":"请输入 work_name","form-value-placeholder":"请输入 work_desc","formkey-validator":e.workNameValidator},on:{handleSubmit:e.editWork}},[r("span",{attrs:{slot:"extra"},slot:"extra"},[r("FormItem",{attrs:{label:"work_type"}},[r("Select",{attrs:{transfer:!0},model:{value:e.current_work_type,callback:function(t){e.current_work_type=t},expression:"current_work_type"}},[r("Option",{key:"filter",attrs:{value:"filter"}},[e._v("filter")]),e._v(" "),r("Option",{key:"work",attrs:{value:"work"}},[e._v("work")])],1)],1),e._v(" "),r("FormItem",{attrs:{label:"module_name"}},[r("Input",{staticStyle:{width:"85%"},attrs:{readonly:"readonly"},model:{value:e.current_module_name,callback:function(t){e.current_module_name="string"==typeof t?t.trim():t},expression:"current_module_name"}}),e._v(" "),r("Poptip",{attrs:{placement:"left-start",width:"420"},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[r("a",{attrs:{href:"javascript:;"}},[e._v("选择模块")]),e._v(" "),r("div",{attrs:{slot:"content"},slot:"content"},e._l(e.modules,function(t){return r("span",{staticStyle:{margin:"5px",float:"left"}},[r("Tag",[r("a",{on:{click:function(r){e.closePoptip(t.module_name)}}},[e._v(e._s(t.module_name))])])],1)}))])],1),e._v(" "),r("FormItem",{attrs:{label:"cache_result"}},[r("Select",{attrs:{transfer:!0},model:{value:e.current_cache_result,callback:function(t){e.current_cache_result=t},expression:"current_cache_result"}},[r("Option",{key:"true",attrs:{value:"true"}},[e._v("true")]),e._v(" "),r("Option",{key:"false",attrs:{value:"false"}},[e._v("false")])],1)],1)],1)])],1)],1),e._v(" "),r("Row",{attrs:{slot:"right"},slot:"right"},[r("Col",{attrs:{span:"4"}},[r("Poptip",{attrs:{trigger:"hover",title:"根据步骤类型搜索",content:"content",width:500,"word-wrap":!0}},[r("Button",{attrs:{size:"small"}},[e._v("步骤类型搜索")]),e._v(" "),r("div",{attrs:{slot:"content"},slot:"content"},e._l(e.nodeMetas,function(t,n){return r("Tag",[r("span",{on:{click:function(r){e.chooseWorkStepType(t.name)}}},[e._v(e._s(t.name))])])}))],1)],1),e._v(" "),r("Col",{attrs:{span:"20"}},[r("ISimpleSearch",{ref:"search",on:{handleSimpleSearch:e.handleSearch}})],1)],1)],1),e._v("\n\n  所有类型：\n  "),r("Tag",{attrs:{color:"all"==e.search_work_type?"success":"default"}},[r("span",{on:{click:function(t){e.filterWorkTypes("all")}}},[e._v("all")])]),e._v(" "),r("Tag",{attrs:{color:"work"==e.search_work_type?"success":"default"}},[r("span",{on:{click:function(t){e.filterWorkTypes("work")}}},[e._v("work")])]),e._v(" "),r("Tag",{attrs:{color:"filter"==e.search_work_type?"success":"default"}},[r("span",{on:{click:function(t){e.filterWorkTypes("filter")}}},[e._v("filter")])]),e._v(" "),r("br"),e._v("\n  所有模块：\n  "),r("Tag",{attrs:{color:"all"==e.search_module?"success":"default"}},[r("span",{on:{click:function(t){e.filterModuleWork("all")}}},[e._v("all")])]),e._v(" "),e._l(e.modules,function(t){return r("span",[r("Tag",{attrs:{color:e.search_module==t.module_name?"success":"default"}},[r("span",{on:{click:function(r){e.filterModuleWork(t.module_name)}}},[e._v(e._s(t.module_name))])])],1)}),e._v(" "),r("Table",{attrs:{border:"",columns:e.columns1,data:e.works,size:"small"}}),e._v(" "),r("Page",{attrs:{total:e.total,"page-size":e.offset,"show-total":"","show-sizer":"",styles:{"text-align":"center","margin-top":"10px"}},on:{"on-change":e.handleChange,"on-page-size-change":e.handlePageSizeChange}})],2)},staticRenderFns:[]};var f=r("VU/8")(d,h,!1,function(e){r("Rgjo")},"data-v-66c1730c",null);t.default=f.exports},Rgjo:function(e,t){}});
//# sourceMappingURL=15.ee74e3a99888eb9e3239.js.map