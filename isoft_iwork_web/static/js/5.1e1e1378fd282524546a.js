webpackJsonp([5],{"/3tv":function(t,e){},KNcB:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n("Xxa5"),a=n.n(s),r=n("exGp"),l=n.n(r),o=n("gyMJ"),c=n("mvHQ"),i=n.n(c),u=n("GCuT"),d={name:"QuickTable",props:{tableName:{type:String,default:""},tableColumns:{type:Array,default:[]},tableSqls:{type:Array,default:[]}},data:function(){return{split1:.4,checkTableColumns:[],customSqls:[],appendSqlElements:[],hotSqlElements:["select","update","set","insert into","values","(",")","count(*) as count","where","from","where 1=0"]}},methods:{chooseAll:function(){this.checkTableColumns.length>0?this.checkTableColumns=[]:this.checkTableColumns=this.tableColumns},toggleAll:function(){var t=this;this.checkTableColumns=this.tableColumns.filter(function(e){return!Object(u.g)(e,t.checkTableColumns)})},appendColumn:function(){this.checkTableColumns.length>0&&(this.customSqls.push(this.checkTableColumns.join(",")),this.customSqls.push(this.checkTableColumns.map(function(t){return t+"=?"}).join(" and ")))},deleteCustom:function(t){this.customSqls.splice(t,1)},renderSql:function(){var t=this;this.$Modal.info({title:"sql 预览",width:500,content:this.appendSqlElements.join(" "),render:function(e){return e("div",{style:"word-break: break-all;"},t.appendSqlElements.join(" "))}})},deleteElement:function(t){t.preventDefault();var e=t.dataTransfer.getData("Text"),n=JSON.parse(e),s=n.index;n.transferData;"right"==n.location&&this.appendSqlElements.splice(s,1)},dragstart:function(t,e,n,s){t.dataTransfer.setData("Text",i()({transferData:e,index:n,location:s}))},allowDrop:function(t){t.preventDefault()},drop:function(t,e){t.stopPropagation(),t.preventDefault();var n=t.dataTransfer.getData("Text"),s=JSON.parse(n),a=s.index,r=s.transferData,l=s.location;e>0?a>=0?Object(u.j)(this.appendSqlElements,a,e):this.appendSqlElements.splice(e+1,0,s.transferData):"right"!=l&&this.appendSqlElements.push(r)}},filters:{filterLimitFunc:function(t){return t&&t.length>80&&(t=t.substring(0,80)+"..."),t}}},p={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{margin:"10px"}},[n("div",[n("div",{staticStyle:{border:"1px solid #dcdee2",padding:"20px"}},t._l(t.hotSqlElements,function(e,s){return n("span",{attrs:{draggable:"true"},on:{dragstart:function(n){t.dragstart(n,e,-1,"left")}}},[n("Button",{staticStyle:{margin:"2px"},attrs:{size:"small"}},[t._v(t._s(e))])],1)})),t._v(" "),n("div",[n("div",{staticStyle:{"text-align":"right","margin-top":"5px","margin-bottom":"5px"}},[n("span",{on:{drop:function(e){t.deleteElement(e)},dragover:function(e){t.allowDrop(e)}}},[n("Button",{attrs:{type:"primary",size:"small",icon:"md-close"}},[t._v("拖拽至此处进行删除")])],1),t._v(" "),n("Button",{attrs:{type:"dashed",size:"small"},on:{click:t.renderSql}},[t._v("Render Sql")])],1),t._v(" "),n("div",{staticStyle:{"min-height":"100px",border:"1px solid #dcdee2",padding:"20px"},on:{drop:function(e){t.drop(e,-1)},dragover:function(e){t.allowDrop(e)}}},t._l(t.appendSqlElements,function(e,s){return n("span",{attrs:{draggable:"true"},on:{dragstart:function(n){t.dragstart(n,e,s,"right")},drop:function(e){t.drop(e,s)},dragover:function(e){t.allowDrop(e)}}},[n("Tooltip",{attrs:{content:e,placement:"bottom","max-width":"800"}},[n("Button",{staticStyle:{margin:"2px"},attrs:{size:"small"}},[t._v(t._s(t._f("filterLimitFunc")(e)))])],1)],1)}))])]),t._v(" "),n("Row",{staticStyle:{"margin-top":"10px"}},[n("Col",{attrs:{span:"4"}},[n("p",{staticStyle:{color:"red"}},[t._v("表名："+t._s(t.tableName))]),t._v(" "),n("CheckboxGroup",{model:{value:t.checkTableColumns,callback:function(e){t.checkTableColumns=e},expression:"checkTableColumns"}},[n("ul",t._l(t.tableColumns,function(t){return n("li",{staticStyle:{"list-style":"none"}},[n("Checkbox",{attrs:{label:t}})],1)}))]),t._v(" "),n("p",{staticStyle:{"margin-top":"10px"}},[n("Button",{attrs:{type:"dashed",size:"small"},on:{click:t.chooseAll}},[t._v("全选")]),t._v(" "),n("Button",{attrs:{type:"dashed",size:"small"},on:{click:t.toggleAll}},[t._v("反选")]),t._v(" "),n("Button",{attrs:{type:"dashed",size:"small"},on:{click:t.appendColumn}},[t._v("Apply")])],1)],1),t._v(" "),n("Col",{attrs:{span:"20"}},[n("p",{staticStyle:{color:"red"}},[t._v("sql信息")]),t._v(" "),n("ul",[t._l(t.tableSqls,function(e){return n("li",{staticStyle:{"list-style":"none"},attrs:{draggable:"true"},on:{dragstart:function(n){t.dragstart(n,e,-1,"bottom")}}},[n("Tooltip",{attrs:{content:e,placement:"bottom","max-width":"800"}},[n("Button",{staticStyle:{margin:"2px"},attrs:{size:"small"}},[t._v(t._s(t._f("filterLimitFunc")(e)))])],1)],1)}),t._v(" "),t._l(t.customSqls,function(e,s){return n("li",{staticStyle:{"list-style":"none"},attrs:{draggable:"true"},on:{dragstart:function(n){t.dragstart(n,e,-1,"bottom")}}},[n("Tooltip",{attrs:{content:e,placement:"bottom","max-width":"800"}},[n("Button",{staticStyle:{margin:"2px"},attrs:{size:"small"}},[t._v("自定义sql："+t._s(t._f("filterLimitFunc")(e)))])],1),t._v(" "),n("Button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){t.deleteCustom(s)}}},[t._v("删除")])],1)})],2)])],1)],1)},staticRenderFns:[]};var m={name:"QuickResource",components:{QuickTable:n("VU/8")(d,p,!1,function(t){n("zU8c")},"data-v-1dcffd6e",null).exports},props:{resource:{type:Object,default:{}}},data:function(){return{choose_table_name:"",tableNames:[],tableColumnsMap:{},tableSqlMap:{}}},methods:{loadQuickSqlMeta:function(){var t=l()(a.a.mark(function t(){var e;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(o.Z)(this.resource.id);case 2:"SUCCESS"==(e=t.sent).status&&(this.tableNames=e.tableNames,this.tableColumnsMap=e.tableColumnsMap,this.tableSqlMap=e.tableSqlMap);case 4:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),getTableColumns:function(t){return this.tableColumnsMap[t]},getTableSqls:function(t){return this.tableSqlMap[t]}},mounted:function(){this.loadQuickSqlMeta()}},h={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("span",{staticStyle:{"margin-top":"10px"}},[t._v("\n  选择数据表：\n  "),n("Select",{staticStyle:{width:"400px"},model:{value:t.choose_table_name,callback:function(e){t.choose_table_name=e},expression:"choose_table_name"}},t._l(t.tableNames,function(e){return n("Option",{key:e,attrs:{value:e}},[t._v("\n      "+t._s(e)+"\n    ")])})),t._v(" "),t._l(t.tableNames,function(e){return t.choose_table_name==e?n("div",[n("QuickTable",{attrs:{"table-name":e,"table-columns":t.getTableColumns(e),"table-sqls":t.getTableSqls(e)}})],1):t._e()})],2)},staticRenderFns:[]};var f={name:"QuickSql",components:{QuickResource:n("VU/8")(m,h,!1,function(t){n("NNhO")},"data-v-e655fc8a",null).exports},data:function(){return{resources:[],currentResource:null,choose_resource_dsn:""}},methods:{refreshAllResource:function(){var t=l()(a.a.mark(function t(){var e;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(o.O)("db");case 2:"SUCCESS"==(e=t.sent).status&&(this.resources=e.resources);case 4:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),chooseResource:function(){var t=this;this.currentResource=this.resources.filter(function(e){return e.resource_dsn==t.choose_resource_dsn})[0]}},mounted:function(){this.refreshAllResource()}},_={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t._v("\n  切换数据源：\n  "),n("Select",{staticStyle:{width:"400px"},on:{"on-change":t.chooseResource},model:{value:t.choose_resource_dsn,callback:function(e){t.choose_resource_dsn=e},expression:"choose_resource_dsn"}},t._l(t.resources,function(e){return n("Option",{key:e.resource_dsn,attrs:{value:e.resource_dsn}},[t._v("\n      "+t._s(e.resource_name)+" ~ "+t._s(e.resource_dsn)+"\n    ")])})),t._v(" "),t.currentResource?n("QuickResource",{attrs:{resource:t.currentResource}}):t._e()],1)},staticRenderFns:[]};var b=n("VU/8")(f,_,!1,function(t){n("/3tv")},"data-v-82702ff2",null);e.default=b.exports},NNhO:function(t,e){},zU8c:function(t,e){}});
//# sourceMappingURL=5.1e1e1378fd282524546a.js.map